#!/bin/bash

usage()
{
    cat << EOT
Usage:
    save           Push conf changes to omnimike/conf
    load           Pull conf changes from omnimike/conf
    status         Show changes to conf
    install-vim    Install the ~/.vimrc file and vim-plug
    install-bin    Install this script to ~/bin
    install-zsh    Install zsh scripts to ~/.oh-my-zsh/custom
EOT
}

SOURCE_FILE="${BASH_SOURCE}"
if [ -L $SOURCE_FILE ]; then
    SOURCE_FILE="$( readlink $SOURCE_FILE )"
fi
CONF_DIR="$( cd "$( dirname "$SOURCE_FILE" )" && pwd )"/..

die()
{
    echo "$@" >&2
    exit 1
}

save()
{
    git -C $CONF_DIR add -f . || die
    git -C $CONF_DIR commit -m "save" || die
    git -C $CONF_DIR push || die
}

load()
{
    git -C $CONF_DIR pull
}

status()
{
    git -C $CONF_DIR status
}

install_vim()
{
    ln -s $CONF_DIR/init.vim $HOME/.vimrc
    curl -fLo $HOME/.vim/autoload/plug.vim --create-dirs \
        https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    mkdir -p $HOME/.vim/swapfiles
}

install_bin()
{
    mkdir -p $HOME/bin || die "Couldn't create ~/bin"
    ln -s $CONF_DIR/bin/* $HOME/bin
    echo "Remember to add ~/bin to your path"
}

install_zsh()
{
    ln -s $CONF_DIR/zsh/* $HOME/.oh-my-zsh/custom
}

case $1 in
    save) save
        ;;
    load) load
        ;;
    status) status
        ;;
    install-vim) install_vim
        ;;
    install-bin) install_bin
        ;;
    install-zsh) install_zsh
        ;;
    -h | help | --help) usage
        ;;
    *) usage
        die
        ;;
esac
